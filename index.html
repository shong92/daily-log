<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>기획세포 일일로그</title>
  <style>
    :root {
      --bg: #f8f8f8;
      --fg: #000;
      --card: #fff;
      --border: #ccc;
      --accent: #4a90e2;
      --entry-border: #eee;
    }

    body.dark {
      --bg: #121212;
      --fg: #f2f2f2;
      --card: #1e1e1e;
      --border: #333;
      --accent: #90c3ff;
      --entry-border: #444;
    }

    body {
      background: var(--bg);
      color: var(--fg);
      font-family: sans-serif;
      margin: 0;
      padding: 0;
    }

    .wrapper {
      display: flex;
      justify-content: center;
      padding: 2em 1em;
    }

    .container {
      width: 100%;
      max-width: 600px;
      background: var(--card);
      padding: 20px;
      box-shadow: 0 0 10px rgba(0,0,0,0.05);
      border-radius: 10px;
      border: 1px solid var(--border);
      position: relative;
    }

    .dark-toggle {
      position: absolute;
      top: 15px;
      right: 15px;
      background: none;
      border: none;
      font-size: 1.2em;
      cursor: pointer;
      color: var(--fg);
    }

    h2 {
      font-size: 1.5em;
      text-align: center;
      margin: 0 0 20px 0;
    }

    input[type="date"],
    textarea,
    button {
      width: 100%;
      box-sizing: border-box;
      margin-top: 10px;
      padding: 10px;
      font-size: 1em;
      border: 1px solid var(--border);
      border-radius: 5px;
      background: var(--card);
      color: var(--fg);
    }

    textarea::placeholder {
      color: #aaa;
    }

    button {
      background-color: var(--accent);
      color: white;
      font-weight: bold;
      border: none;
      cursor: pointer;
    }

    button:hover {
      opacity: 0.9;
    }

    .emoji-picker {
      margin-top: 5px;
      display: flex;
      flex-wrap: wrap;
      gap: 5px;
    }

    .emoji {
      cursor: pointer;
      font-size: 1.3em;
    }

    .log-entry {
      border-bottom: 1px solid var(--entry-border);
      padding: 10px 0;
      padding-right: 0;
      position: relative;
      display: flex;
      flex-direction: column;
      gap: 4px;
      word-wrap: break-word;
    }

    .log-entry-content {
      padding-right: 60px; /* 공간 확보 */
    }

    .time {
      color: #888;
      font-size: 0.85em;
    }

    .delete-btn {
      position: absolute;
      top: 10px;
      right: 10px;
      background: none;
      border: 1px solid var(--accent);
      color: var(--accent);
      padding: 2px 6px;
      font-size: 0.75em;
      border-radius: 4px;
      cursor: pointer;
      transition: 0.2s;
      white-space: nowrap;
    }

    .delete-btn:hover {
      background-color: rgba(74,144,226,0.1);
    }

    @media (max-width: 400px) {
      .delete-btn {
        font-size: 0.7em;
        padding: 1px 5px;
      }
    }
  </style>
</head>
<body>
  <script>
    const correctHash = "5dfa4c51dcc091801d8a6b6d2aed69119239a1f4e458cc06a326c6a9b0a09576"; // 비밀번호 해시
    const unlockHash = "d0832287613be2ffed93a1c523735101c21d3b2b457a3d1d93f211544bb0583a"; // 잠금 해제 비밀번호 해시
  
    async function sha256(text) {
      const encoded = new TextEncoder().encode(text);
      const buffer = await crypto.subtle.digest("SHA-256", encoded);
      return Array.from(new Uint8Array(buffer)).map(b => b.toString(16).padStart(2, "0")).join("");
    }
  
    async function promptPassword() {
      if (localStorage.getItem("dailyLogUnlocked") === "true") return;
  
      if (localStorage.getItem("lockout") === "true") {
        const unlockInput = prompt("🔒 잠금이 설정되었습니다. 잠금 해제 비밀번호를 입력하세요:");
        const unlockTry = await sha256(unlockInput);
        if (unlockTry === unlockHash) {
          localStorage.removeItem("lockout");
          localStorage.setItem("loginAttempts", "0");
          alert("잠금이 해제되었습니다. 다시 로그인 해주세요.");
          promptPassword();
          return;
        } else {
          document.body.innerHTML = "<h2 style='text-align:center; color:red;'>잠금 해제 실패</h2>";
          throw new Error("잠금 해제 실패");
        }
      }
  
      let attempts = parseInt(localStorage.getItem("loginAttempts") || "0");
      while (attempts < 3) {
        const input = prompt("🔒 비밀번호를 입력하세요 (4자리):");
        const hashed = await sha256(input);
        if (hashed === correctHash) {
          localStorage.setItem("dailyLogUnlocked", "true");
          return;
        } else {
          attempts++;
          localStorage.setItem("loginAttempts", attempts);
          alert(`비밀번호가 틀렸습니다. (${attempts}/3)`);
        }
      }
  
      localStorage.setItem("lockout", "true");
      document.body.innerHTML = "<h2 style='text-align:center; color:red;'>잠금되었습니다. 잠금 해제 후 다시 시도하세요.</h2>";
      throw new Error("잠금됨");
    }
  
    await promptPassword();
  
  <div class="wrapper">
    <div class="container">
      <button class="dark-toggle" onclick="toggleDarkMode()">🌙</button>

      <h2>📝 기획세포 일일로그</h2>

      <input type="date" id="dateFilter" onchange="filterLogs()" />

      <textarea id="logText" placeholder="오늘의 활동을 입력하세요..."></textarea>

      <div class="emoji-picker">
        <span class="emoji" onclick="insertEmoji('😊')">😊</span>
        <span class="emoji" onclick="insertEmoji('🔥')">🔥</span>
        <span class="emoji" onclick="insertEmoji('💡')">💡</span>
        <span class="emoji" onclick="insertEmoji('✏️')">✏️</span>
        <span class="emoji" onclick="insertEmoji('✅')">✅</span>
        <span class="emoji" onclick="insertEmoji('✨')">✨</span>
        <span class="emoji" onclick="insertEmoji('⚡')">⚡</span>
      </div>

      <button onclick="saveLog()">✅ 기록하기</button>

      <div id="logList"></div>
    </div>
  </div>

    const logKey = "dailyLogData";
    const darkKey = "logAppDarkMode";

    function loadLogs() {
      return JSON.parse(localStorage.getItem(logKey)) || [];
    }

    function saveLog() {
      const text = document.getElementById('logText').value.trim();
      if (!text) return;

      const now = new Date();
      const date = now.toISOString().slice(0, 10);
      const time = now.toLocaleTimeString();
      const id = Date.now();

      const newLog = { id, text, date, time };
      const logs = loadLogs();
      logs.push(newLog);
      localStorage.setItem(logKey, JSON.stringify(logs));

      document.getElementById('logText').value = '';
      filterLogs();
    }

    function deleteLog(id) {
      let logs = loadLogs();
      logs = logs.filter(log => log.id !== id);
      localStorage.setItem(logKey, JSON.stringify(logs));
      filterLogs();
    }

    function renderLogs(filteredLogs) {
      const logList = document.getElementById('logList');
      logList.innerHTML = '';
      filteredLogs.reverse().forEach(({ id, text, date, time }) => {
        const logHTML = `
          <div class="log-entry">
            <div class="log-entry-content">
              <div class="time">${date} ${time}</div>
              <div>${text}</div>
            </div>
            <button class="delete-btn" onclick="deleteLog(${id})">삭제</button>
          </div>`;
        logList.insertAdjacentHTML('beforeend', logHTML);
      });
    }

    function filterLogs() {
      const selectedDate = document.getElementById('dateFilter').value;
      const allLogs = loadLogs();
      const filtered = selectedDate
        ? allLogs.filter(log => log.date === selectedDate)
        : allLogs;
      renderLogs(filtered);
    }

    document.getElementById('logText').addEventListener('keydown', function(e) {
      if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        saveLog();
      }
    });

    function insertEmoji(emoji) {
      const textarea = document.getElementById('logText');
      textarea.value += emoji;
      textarea.focus();
    }

    function toggleDarkMode() {
      document.body.classList.toggle('dark');
      const isDark = document.body.classList.contains('dark');
      localStorage.setItem(darkKey, isDark ? "true" : "false");
    }

    function loadDarkMode() {
      const saved = localStorage.getItem(darkKey);
      if (saved === "true") {
        document.body.classList.add('dark');
      }
    }

    loadDarkMode();
    filterLogs();
  </script>

</body>
</html>
